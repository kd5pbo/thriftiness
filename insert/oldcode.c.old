/* Number of free bytes after the = in an environment variable */
int naftereq(char *v, int vlen);

/* Number of free bytes after the = in an environment variable */
int naftereq(char *v, int vlen) {
        char *e; /* Location of the equals */
        char *z; /* Location of the null byte */
        for (e = v; e - v < vlen; ++e) {
                /* Stop when we've found a = or at the end of the string. */
                if ('=' == *e) {
                        break;
                }
                /* It's an error if there's no '=' */
                if ('\0' == *e) {
                        return -1;
                }
        }


        /* Error if we're too far */
        if (e - (v-1) >= vlen) {
                return -2;
        }

        /* Count the number of remaining bytes */
        for (z = e; z - v < vlen; ++z) {
                if ('\0' == *z) {
                        break;
                }
        }

        /* Error if we're too far */
        if ((z-1) - (v-1) > vlen) {
                return -3;
        }

        /* Report the number of available bytes */
        return (int)((z - e) - 1);
}
